# 网络数据封装传输过程
我们在浏览器中输入百度网址（如www.baidu.com），就能收到百度服务器返回的页面（示意图如下）。
![百度相应页面](../images/baidu.png)


这一过程的核心是“数据封装→网络传输→数据解封装”的循环:
![示意图](../images/data%20encapsulation.png)
*图左为百度服务器，图右（主机A）为用户主机*

## 前置步骤：DNS域名解析
输入网址后，主机A会先通过 DNS协议（应用层） 将域名www.baidu.com解析为百度服务器的公网IP地址——这是后续IP寻址的基础，没有IP就无法定位目标服务器。


##       封装（主机A→百度服务器）

封装是“自上而下”给数据加“头部标签”的过程，每层标签负责不同的寻址/校验功能。如上图所示，在浏览器中输入网址（应用层）后，应用层就开始往下传输。

1. **应用层**：浏览器将用户的访问请求（如“获取百度首页”）封装为 **应用层数据单元**（HTTPS协议的报文），明确请求类型、数据格式等，随后向下传递至传输层。

2. **传输层**：因HTTPS基于TCP协议，传输层会为应用层数据 **封装TCP头部**，核心添加：        

    源端口：主机A随机分配（如54321），用于后续服务器回传数据时定位主机A的浏览器；

    目的端口：HTTPS默认443（HTTP默认80），用于服务器识别“该用HTTPS程序处理数据”（识别该用哪个端口）；

    序号/确认号：保证数据可靠传输（TCP的核心特性）。

3. **网络层**：为TCP报文 **封装IP头部**，核心包含：        

    源IP：主机A的IP（如局域网192.168.1.2，经路由器NAT转换为公网IP）；

    目的IP：DNS解析得到的百度服务器IP（如180.101.49.11）；

4. **数据链路层**：为IP数据报 **封装MAC头部**，核心包含：       

    源MAC：当前链路的发送设备MAC（如主机A的网卡MAC、路由器的端口MAC）；

    目的MAC：当前链路的接收设备MAC（如路由器的端口MAC、服务器的网卡MAC）；

5. **物理层**：将数据链路层的“以太帧”转换为 **比特流**（0和1的电信号/光信号），通过传输介质（网线、光纤、无线信号）发送到网络中，从主机A发送到百度服务器

##       解封装（百度服务器→主机A）
解封装是“自下而上”拆去头部标签、还原数据的过程，每层会先校验标签合法性，再向上传递：

1. **物理层**：百度服务器的物理层接收比特流，还原为数据链路层的“以太帧”，传递至数据链路层。
2. **数据链路层**：校验MAC头部——确认“目的MAC是本机网卡MAC”后，拆去MAC头部，将内部的IP数据报传递至网络层（若MAC不匹配，直接丢弃数据）。
3. **网络层**：校验IP头部——确认“目的IP是本机公网IP”后，拆去IP头部，将内部的TCP报文传递至传输层（若IP不匹配，可能转发或丢弃）。
4. **传输层**：校验TCP头部——通过序号/确认号确认数据完整、无丢失后，拆去TCP头部，根据目的端口（443）识别应用层协议，将核心请求数据传递至应用层。
5. **应用层**：HTTPS程序解析请求数据，明确用户需求（如“获取首页”），生成对应的 **响应报文**（包含百度首页的HTML、CSS、图片等数据，也就是我们看到的百度页面）。


    

   ***于是图左侧的百度服务器将响应消息一路向下封装后传给右侧主机A，主机A收到后再一路向上进行解封装，得到了百度服务器给的响应页面。***
